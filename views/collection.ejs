<html>
<head>

  <title>コレクション</title>

  <!-- meta tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <!-- CSS links -->
  <link href="../public/css/main.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css">
  <link href="../public/css/transitions.css" rel="stylesheet" type="text/css" />
  

</head>

<body>

  <style>

    :root {
      --fruityTooty: linear-gradient(90deg, rgb(255, 248, 85) 0.04%, rgb(70, 227, 183) 100.04%);
      --tinder:  linear-gradient(285.49deg, rgb(245, 55, 249) -14.61%, rgb(247, 190, 43) 106.06%);
      --chilly: linear-gradient(124.31deg, rgb(70, 227, 183) 0.18%, rgb(82, 124, 172) 89.82%);
      --depression: linear-gradient(285.49deg, rgb(148, 151, 157) -14.61%, rgb(118, 124, 175) 106.06%);

    }
    
    html:before {
      background: black;
    }


    html {
      background: black;
    }

    #card-container {
      width: 90%;
      margin: auto;
      margin-top: 10;
      display: flex;
      flex-direction: column;   
      align-items: center;
      justify-content: center;
      gap:20;
      perspective: 1400px;

    }

    .card {
      position: relative;
      height: 20rem;
      width: 20rem;
    }


    .card:nth-child(2n) {
      margin-left: 25rem;
    }

    .card:nth-child(4n) .kanji-smol {
      font-size: 40px;
      line-height: 48px;
      -webkit-text-fill-color: transparent;
      background: var(--chilly);
      font-family: "yasashisa";
      -webkit-background-clip: text;
    }

    .card:nth-child(3n) .kanji-smol {
      font-size: 40px;
      line-height: 48px;
      -webkit-text-fill-color: transparent;
      background: var(--tinder);
      font-family: "yasashisa";
      -webkit-background-clip: text;
    }

    .card:nth-child(2n) .kanji-smol {
      font-size: 40px;
      line-height: 48px;
      -webkit-text-fill-color: transparent;
      background: var(--depression);
      font-family: "yasashisa";
      -webkit-background-clip: text;
    }

    .card-content{
      backface-visibility: hidden;
      text-align: center;
      margin: 0;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .hex-container {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 0;
      margin: 0;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      transform-style: preserve-3d;
    }

    .hex-container:before{
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			width: 50%;
			height: 100%;
			pointer-events: none;
			background: rgba(255, 255, 255, 0.02);
		}

    .hex-container:last-child {
      margin-right: 0;
    }
    .hex-container:hover .hex:last-child {
      opacity: 1;
      transform: scale(1.3);
    }
    .hex-container:hover .hex:first-child {
      opacity: 1;
      transform: scale(1.2);
    }
    .hex-container:hover .hex:first-child div:before, .hex-container:hover .hex:first-child div:after {
      height: 15px;
    }


    .hex {
      position: absolute;
      width: 100px;
      height: 173.2050807569px;
      opacity: 0.5;
    }
    .hex:first-child {
      transform: scale(0.9);
      transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
      z-index: 0;
    }
    .hex:last-child {
      transition: all 0.3s cubic-bezier(0.19, 1, 0.22, 1);
      z-index: 1;
    }
    .hex div {
      box-sizing: border-box;
      position: absolute;
      top: 0;
      width: 100px;
      height: 173.2050807569px;
      transform-origin: center center;
    }
    .hex div:before, .hex div:after {
      content: ' ';
      position: absolute;
      background: rgba(255, 255, 255, 1);
      width: 100%;
      height: 1px;
      transition: height 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    }
    .hex div:before {
      top: 0;
    }
    .hex div:after {
      bottom: 0;
    }
    .hex div:nth-child(1) {
      transform: rotate(0deg);
    }
    .hex div:nth-child(2) {
      transform: rotate(60deg);
    }
    .hex div:nth-child(3) {
      transform: rotate(120deg);
    }



    .back{
      position: absolute;
      top: 20%;
      left: 0;
      right: 0;
      margin: auto;
      width: 100px; 
      transform: rotateY(180deg);
    }

    .topCard-container{
      margin-top: 5vh;
      box-sizing: border-box;
      text-align: center;
      perspective: 1400px;

    }
    .topCard {
      font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      z-index: 0;
      width: 10vw;
      margin-right: 1em;
      padding: 1rem;
      border-radius:20px;
      background-color: rgb(0, 0, 0);
      text-align: center;
      display: inline-block;
      transform-style: preserve-3d;
      border: 2px solid #F80;
    }

    .topCard:hover {
      box-shadow: 0px 4px #F80;
      cursor: pointer;
    }

    #barTotal {
      width: 0%;
      height: 2.2vh;
      font-size: 1.5em;
      background-color: #4CAF50;
      text-align: center;
      line-height: 8vh;
      color: white;
    }


    #barTotalFull {

      height: 2.2vh;
      font-size: 1.5em;
      background-color: rgba(255, 255, 255, 0.2);
      text-align: center;
      line-height: 8vh;
      color: white;
      margin-top:3vh;
      margin-left: 10vw;
      margin-right: 12vw;
      
    }

    #seeFull {
      font-size:3em;
      text-align: center;
      position: relative;
      transition: 0.5s;
    }
    #seeFull:after {
      content: '';
      position: absolute;
      width: 100%;
      transform: scaleX(0);
      height: 2px;
      bottom: 0;
      left: 0;
      background-color: rgba(255,255,0);
      transform-origin: bottom right;
      transition: transform 0.25s ease-out;
    }
    #seeFull:hover:after {
      transform: scaleX(1);
      transform-origin: bottom left;
    }

    .see-cont{
      margin-top: 10vh;
      width: 50%;
      margin: auto;
    }

    .kanji-smol {
      font-size: 40px;
      line-height: 48px;
      -webkit-text-fill-color: transparent;
      background: var(--fruityTooty);
      font-family: "yasashisa";
      -webkit-background-clip: text;
    }


    .hira-smol {
      font-size: 2em;
      font-family: "yasashisa";
      margin-bottom: 10;
    }


    .translation {
      font-size: 2em;
      margin-bottom: 2;
    }

    .progress-bar-smol {
      font-size: 2em;
      margin-bottom: 10;
    }

    .percent-bar {
      height:1.5vh;
      margin-top: 5px;
      background-color: #04AA6D;
      text-align: center;
      line-height: 30px;
      color: white;
    }

    .percent-bar-full{
      margin-top: 5px;
      height: 1.1vh;
      background-color: rgba(255,255,255,0.2);
    }

    .selectedLink{
      color:red;
      z-index: 222;
    }
    
    .break {
      margin: 50px 0;
    }

    .pageNav {
      font-size: 3em;
      display: flex;
      justify-content: center;
  
      overflow: hidden;
    }

    .pageNav a{
      width: 100px;

      text-align: center;
      font-weight: 700;
      transition: .3s linear;
    }

    .pageNav a:hover{

      color:rgba(0, 128, 255, 1);
      transform: scale(0.8)
    }
    

  </style>

  <header>
    <nav class="g-nav">
  
      
        <form action="/" method="GET">
          <button type="submit" class="btn-home">家</button>
        </form>
  
        <form action="/collection/home" method="GET">
          <button type="submit" class="btn-collection">コレクション</button>
        </form>
      
        <form action="/kuro" method="GET">
          <button type="submit" class="btn-collection">光</button>
        </form>
  
      
        <form action="/logout" method="GET">
          <button type="submit" class="btn-logout">ログアウト</button>
        </form>
             
    </nav>
  </header>

  <% if (page < 1) { %><p style="font-size:3em;text-align:center;margin-top:5%">Total</p> <div id="barTotalFull"><div id="barTotal"></div></div>
  <p style="font-size:3em;text-align:center;margin-top:2%">Top 6</p>
          <div class="topCard-container">
           <% for (var i = 0; i < topHighest.length; i++){ %>
            <% let obj = db.find(o => o.word_id === topHighest[i].word_id) %>
            <div class="topCard">
              <div class="front">
                <div class="kanji-smol">
                  <%=obj.kanj %>
                </div>
                <div class="progress-bar-smol">
                  <div class="percent-progress">
                    <%=topHighest[i].HighestCount%>%
                    <div class="percent-bar-full"><div class="percent-bar" style="width:<%=topHighest[i].HighestCount%>"></div></div>
                  </div>
                </div>
              </div>
              <div class="back">
                <div class="hira-smol">
                  <%=obj.hira %>
                </div>
                <div class="translation">
                  <%=obj.eng %>
                </div>
              </div>
            </div>
            <% } %>
          </div>
        
        <p style="text-align:center;margin-top:10vh;font-size:2.5em;margin-bottom:10vh">↓      See full collections      ↓</p>
  <div class="see-cont">
    <a id="seeFull" style="float:left" href="/collection/n5?page=1">JLPT N5</a>
    <a id="seeFull" style="float:right" href="/collection/n4?page=1">JLPT N4</a>
  </div>
  
  <% } else { %><div id="barTotalFull" style="visibility:hidden;"><div id="barTotal" style="visibility:hidden;"></div></div>

  <div id="card-container">
    <% db.forEach(entry => { %>

    <div class="card">

      <div class="card-content <%=entry.word_id %>">
        <!-- Content 1 -->
        <div class="front">
          <a class="kanji-smol">
            <%=entry.kanj %>
          </a>
          <div class="progress-bar-smol">
            <div class="percent-progress">
              <% let counted = 0 %>
              <% for (var i = 0; i < counter.length; i++){ %>
                <% if (counter[i].word_id == entry.word_id){ %>
                  <% counted = counter[i].count%>
                <% } %>
              <% } %>
              <%=counted%>%
              <div class="percent-bar-full"><div class="percent-bar" style="width:<%=counted%>"></div></div>
            </div>
          </div>
        </div>
        <!-- Content 2 -->
        <div class="back">
          <div class="hira-smol">
            <%=entry.hira %>
          </div>
          <div class="translation">
            <%=entry.eng %>
          </div>
        </div>
      </div>

      <div class="hex-container">
        <div class="hex">
          <div></div>
          <div></div>
          <div></div>
        </div>

        <div class="hex">
          <div></div>
          <div></div>
          <div></div>
        </div>
      </div>

    </div>

    <% }) %>
  
  </div>

  <div class="break"></div>

  <!-- Display links to the pages -->

  <div class="pageNav">

  

  <% if (page > 1) {  %> <a href="/collection/<%=n%>?page=<%=page-1%>"><i class="fas fa-chevron-left"></i></a><% } %>
  <% for (let i = iterator; i <= endingLink; i++) { %>
    <% if (i === page) { %>
      <a class="selectedLink" href="/collection/<%=n%>?page=<%=i%>"><%=i%></a>
      <% continue; %>

  <% } %>
      <a href="/collection/<%=n%>?page=<%=i%>"><%=i%></a>
      <% } %>
      <% if (page < numOfPages) { %> <a href="/collection/<%=n%>?page=<%=page+1%>"><i class="fas fa-chevron-right"></i></a> <% } %>

  <% } %>
  </div>

  <div class="page_transi"><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div><div class="grid_transi"></div></div>


<!-- JavaScript -->

<script src="../public/js/jquery.js"></script>
<script src="../public/js/anime.min.js"></script>
<script src="public/js/kursor.min.js"></script>
<script src="public/js/kursorConfig.js"></script>
<script src="public/js/common.js"></script>
<script>

$( document ).ready(function() {
    $('.grid_transi').addClass('transi_in')
});


  var i = 0;
  if (i == 0) {
    i = 1
    var elem = document.getElementById("barTotal")
    var width = 0
    console.log(('<%=sum[0].total%>'/'<%=numOfResults%>')*100)
    var id = setInterval(frame, 35)
    function frame() {
      if (width >= ('<%=sum[0].total%>'/'<%=numOfResults%>')) {
        clearInterval(id)
        i = 0
      } else {
        width = width + 0.1
        elem.style.width = width + "%"
        elem.innerHTML =  width.toPrecision(2)  + "%"
      }
    }
  }


  var card = document.querySelectorAll(".card")
  var topCard = document.querySelectorAll(".topCard")
  var playing = false

  if(card){
    
    card.forEach(div => div.addEventListener('mouseover', function() {
      if(playing)
        return;

      playing = true;
      anime({
        targets: div,
        /* scale: [{value: 1}, {value: 1.4}, {value: 1, delay: 250}], */
        easing: 'easeInOutSine',
        duration: 300,
        complete: function(anim){
          playing = false
        }
      })
    }))
  }

  if(topCard){
    topCard.forEach(div => div.addEventListener('mouseover', function() {
      if(playing)
        return;

      playing = true;
      anime({
        targets: div,
        /* scale: [{value: 1}, {value: 1.4}, {value: 1, delay: 250}], */
        easing: 'easeInOutSine',
        duration: 300,
        complete: function(anim){
          playing = false
        }
      })
    }))
  }

  







</script>


<script src="../public/js/space.js"></script>
<script src="../public/js/gl-matrix.js"></script>
<script src="../public/js/write.js"></script>
</body>
</html>